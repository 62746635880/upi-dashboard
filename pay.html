<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>UPI Payment Gateway</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col items-center p-6">

<div class="max-w-md w-full bg-white rounded-2xl shadow-xl p-8 relative">
    <!-- Header + Countdown -->
    <div class="flex justify-between items-center mb-6">
        <h1 id="appNameHeader" class="text-2xl font-bold text-indigo-700"></h1>
        <span id="countdown" class="text-red-500 font-semibold"></span>
    </div>

    <!-- Client & Amount -->
    <div class="text-center mb-6">
        <p id="clientNameDisplay" class="text-xl font-semibold text-gray-800"></p>
        <p id="amountDisplay" class="text-green-600 font-bold text-2xl"></p>
    </div>

    <!-- UPI -->
    <div class="flex justify-between items-center mb-6">
        <span id="upiDisplay" class="font-semibold text-indigo-600 break-all"></span>
        <button onclick="copyUPI()" class="bg-indigo-600 text-white px-3 py-1 rounded hover:bg-indigo-700">Copy</button>
    </div>

    <!-- Uploaded QR -->
    <div class="flex justify-center mb-6">
        <img id="qrImage" class="w-48 h-48 object-contain rounded-lg border" alt="QR" />
    </div>

    <!-- Payment Buttons -->
    <div class="grid grid-cols-2 gap-4 mb-6">
        <button class="bg-green-500 text-white py-2 rounded hover:bg-green-600">GooglePe</button>
        <button class="bg-green-700 text-white py-2 rounded hover:bg-green-800">PhonePe</button>
        <button class="bg-yellow-500 text-white py-2 rounded hover:bg-yellow-600">Paytm</button>
        <button class="bg-blue-500 text-white py-2 rounded hover:bg-blue-600">BHIM UPI</button>
    </div>

    <!-- UTR Submission -->
    <div class="mb-6">
        <input type="text" id="utrInput" placeholder="Enter 12-digit UTR" class="w-full p-2 border rounded mb-2">
        <button onclick="submitUTR()" class="w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700">Submit UTR</button>
        <p id="utrError" class="text-red-500 mt-1 hidden">UTR must be 12 digits</p>
    </div>

    <!-- Success Message -->
    <div id="successMsg" class="hidden text-center bg-green-100 text-green-800 p-3 rounded">
        <!-- Filled dynamically -->
    </div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const appName = params.get('appName') || 'App';
const clientName = params.get('nameInput') || 'Customer';
const amount = params.get('amntInput') || '0';
const upi = params.get('vpaInput') || '';
const qrData = params.get('qr') || '';

// Populate fields
document.getElementById('appNameHeader').textContent = appName;
document.getElementById('clientNameDisplay').textContent = clientName;
document.getElementById('amountDisplay').textContent = '₹' + amount;
document.getElementById('upiDisplay').textContent = upi;

if(qrData){
    document.getElementById('qrImage').src = qrData;
} else {
    document.getElementById('qrImage').alt = 'No QR Uploaded';
}

// Copy UPI
function copyUPI(){
    navigator.clipboard.writeText(upi);
    alert("UPI copied!");
}

// Countdown Timer
let timeLeft = 9 * 60; // 9 minutes
const countdownEl = document.getElementById('countdown');
const timerInterval = setInterval(() => {
    const min = Math.floor(timeLeft/60);
    const sec = timeLeft%60;
    countdownEl.textContent = `${min}:${sec.toString().padStart(2,'0')}`;
    if(timeLeft <= 0){
        clearInterval(timerInterval);
        document.body.innerHTML = `<div class="text-center mt-20">
            <h1 class="text-3xl font-bold">Page Expired</h1>
        </div>`;
    }
    timeLeft--;
},1000);

// UTR Submission
function submitUTR(){
    const utr = document.getElementById('utrInput').value.trim();
    if(utr.length !== 12){
        document.getElementById('utrError').classList.remove('hidden');
        return;
    }
    document.getElementById('utrError').classList.add('hidden');
    const successDiv = document.getElementById('successMsg');
    successDiv.innerHTML = `Dear ${clientName} Sir/Mam, your ₹${amount} payment for ${appName} is paid successfully. Please wait while we review the transaction and then you receive NOC of loan closing.`;
    successDiv.classList.remove('hidden');
}
</script>
</body>
</html>
